% Bildverarbeitung Uebung 5
% Ziqing Yu 3218051

clc;
clear all;
close all;

% wie groﬂ ist fucking Maﬂstab
I1 = imread('R0020851.jpg');
figure, imshow(I1);
hold on
[c1,r1] = getline();

scatter(c1,r1,200,'p','r');
Pixel_Koor1 = [c1; r1; 1];

K1 = [-3933.36363636	     0.00000000	   2143.50000000
      0.00000000	     3933.36363636	   1423.50000000
      0.00000000	      0.00000000	      1.00000000];
Bild_Koor1 = K1 \ Pixel_Koor1 ; 


R1 = [-0.827570749773	 -0.557530411593	  0.065471324026
        0.549857636160	 -0.828569770064	 -0.105492730048
        0.113062965097	 -0.051302790236	  0.992262460056];
X1 = [512980.995110; 5427701.526710; 514.794290];
v1 = R1' * Bild_Koor1;


I2 = imread('R0020852.jpg');
figure, imshow(I2);
hold on
[c2,r2] = getline();


scatter(c2,r2,200,'p','r');

Pixel_Koor2 = [c2; r2; 1];
K2 = [-3933.36363636	     0.00000000	   2143.50000000
      0.00000000	   3933.36363636	   1423.50000000
      0.00000000	      0.00000000	      1.00000000];
Bild_Koor2 = K2 \ Pixel_Koor2 ; 


R2 = [-0.866544118547	 -0.490057510421	 -0.094577624687
        0.490759244246	 -0.871123481449	  0.017298677877
        -0.090866136699	 -0.031424776041	  0.995367182829];
X2 = [512966.499230; 5427725.063170; 517.490680];
v2 = R2' * Bild_Koor2;

% Vorw‰rtsschnitt
d = cross(v1,v2);
b = X2 - X1;
lambda = [v1,v2,d] \ b;
Wert_Koor1 = X1 + lambda(1) * v1 + lambda(3) / 2 * d;
Wert_Koor2 = X2 - lambda(2) * v2 - lambda(3) / 2 * d;

% Ruecktransformation
P1 = K1 * [R1, -R1 * X1];
x1 = P1 * [513047.601, 5427704.443, 326.998, 1]';
x1 = x1/x1(3);


P2 = K2 * [R2, -R2 * X2];
x2 = P2 * [513047.601, 5427704.443, 326.998, 1]';
x2 = x2/x2(3);

